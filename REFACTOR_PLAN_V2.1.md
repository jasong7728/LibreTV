# LibreTV V2.1 重构计划书

## 项目概述
LibreTV是一个免费的在线视频搜索与观看平台，V2.1版本在现有V2.0基础上进行优化升级，重点改进用户体验和功能完善。

## 1. 重构目标

### 主要优化方向
1. **豆瓣热门优化**：实现懒加载和分页功能，预加载20个内容，支持无限滚动
2. **播放体验完善**：选集自动跳转播放界面，历史记录联动，离开时自动暂停
3. **样式系统统一**：合并CSS文件，提高样式复用性和维护性
4. **目录结构优化**：重新组织文件结构，提高代码可维护性
5. **用户交互优化**：增加更多人性化细节功能

### 技术要求
- 保持现有技术栈：HTML5 + CSS3 + 原生JavaScript
- 确保三种部署方式兼容：Vercel、Cloudflare Pages、Docker
- 保持现有功能完整性，只做增强不做删减
- 界面风格保持一致，字体大小统一

## 2. V2.1版本功能详细介绍

### 2.1 整体架构
```
LibreTV V2.1
├── 侧边栏导航 (主导航)
│   ├── 搜索界面
│   ├── 豆瓣热门界面  
│   ├── 播放界面
│   ├── 设置界面
│   └── 关于界面
├── 主内容区域 (动态切换)
└── 统一样式系统
```

### 2.2 核心功能模块

#### 搜索界面
- **多源聚合搜索**：整合多个影视资源API，提供丰富内容来源
- **智能搜索历史**：自动保存搜索记录，支持快速重新搜索
- **搜索结果展示**：卡片式布局，显示封面、标题、类型等信息
- **一键播放**：点击搜索结果直接跳转到播放界面
- **实时搜索建议**：输入时提供相关搜索建议

#### 豆瓣热门界面 (重点优化)
- **懒加载机制**：首次加载20个内容，滚动时自动加载更多
- **分页加载**：后台分批获取数据，提高加载速度
- **类型切换**：电影/电视剧独立展示和筛选
- **标签筛选系统**：按地区、类型、年份等维度筛选
- **无限滚动**：用户友好的滚动加载体验
- **内容预览**：悬停显示详细信息和评分
- **收藏功能**：支持添加到个人收藏列表

#### 播放界面 (完善增强)  
- **沉浸式全屏播放**：专注观看体验，最小化干扰元素
- **智能播放控制**：
  - 选集后自动跳转到播放界面
  - 历史记录选中后进入播放界面  
  - 离开播放界面时自动暂停播放
- **进度管理**：自动保存播放进度，支持断点续播
- **选集面板**：侧滑式选集列表，支持快速剧集切换
- **多源支持**：播放失败时自动尝试其他视频源
- **播放记录**：自动记录观看历史，便于续看

#### 设置界面
- **API源管理**：
  - 批量选择/取消API源
  - 添加自定义API接口
  - API状态检测和管理
- **播放设置**：
  - 默认画质选择
  - 自动播放下一集
  - 播放记录保存策略
- **界面设置**：
  - 主题色彩调整
  - 字体大小设置
  - 动画效果开关
- **数据管理**：
  - 配置文件导入/导出
  - 清空缓存和历史数据
  - 重置所有设置到默认值

#### 关于界面 (信息整合)
- **版本信息**：显示当前版本号和更新日志
- **项目统计**：总搜索次数、播放次数、配置API数量、历史记录数量
- **技术栈展示**：项目使用的技术和依赖库
- **开源信息**：GitHub仓库链接、开源协议、贡献者信息
- **帮助文档**：使用指南、快捷键说明、常见问题
- **联系方式**：问题反馈渠道、社区链接

## 3. 详细使用流程

### 3.1 首次访问流程
```
1. 用户访问LibreTV网址
2. 加载主页面，默认显示搜索界面
3. 侧边栏显示所有功能模块入口
4. 引导用户在设置中配置API源(可选)
5. 开始使用各项功能
```

### 3.2 内容搜索流程
```
1. 在搜索界面输入关键词
2. 系统查询已配置的API源
3. 聚合显示搜索结果
4. 用户选择想要观看的内容
5. 自动跳转到播放界面开始播放
6. 搜索历史自动保存
```

### 3.3 豆瓣热门浏览流程
```
1. 点击侧边栏"豆瓣热门"
2. 选择内容类型(电影/电视剧)
3. 可选择标签进行筛选
4. 浏览推荐内容列表
5. 向下滚动自动加载更多内容
6. 点击感兴趣的内容开始播放
```

### 3.4 视频播放流程
```
1. 通过搜索或豆瓣热门选择内容
2. 自动跳转到播放界面
3. 播放器加载并开始播放
4. 可通过选集面板切换不同集数
5. 播放进度自动保存
6. 离开播放界面时自动暂停
```

### 3.5 历史记录使用流程
```
1. 在搜索界面查看播放历史
2. 点击历史记录中的项目
3. 自动跳转到播放界面
4. 从上次观看位置继续播放
5. 历史记录持续更新
```

## 4. 项目结构详细设计

### 4.1 优化后的目录结构
```
LibreTV-V2.1/
├── css/
│   └── styles.css           # 统一合并的样式文件
├── js/
│   ├── core/               # 核心模块
│   │   ├── app.js         # 应用主控制器
│   │   ├── config.js      # 全局配置
│   │   └── router.js      # 路由管理
│   ├── components/        # 功能组件
│   │   ├── sidebar.js     # 侧边栏组件
│   │   ├── search.js      # 搜索组件  
│   │   ├── douban.js      # 豆瓣热门组件(增强)
│   │   ├── player.js      # 播放器组件(完善)
│   │   ├── settings.js    # 设置组件
│   │   └── about.js       # 关于组件(整合)
│   ├── utils/            # 工具模块
│   │   ├── api.js        # API工具
│   │   ├── storage.js    # 存储工具
│   │   └── ui.js         # UI工具
│   └── libs/             # 第三方库
├── images/               # 图片资源
├── api/                  # 后端代理API
├── index.html           # 主页面
├── manifest.json        # PWA配置
├── service-worker.js    # Service Worker
├── server.mjs          # Node.js服务器
└── package.json        # 项目配置
```

### 4.2 样式系统设计
- **统一配色方案**：基于CSS变量的主题色彩系统
- **响应式布局**：移动端优先的响应式设计
- **组件化样式**：可复用的样式组件类
- **动画系统**：统一的过渡动画效果
- **字体系统**：统一的字体大小和行高规范

## 5. 技术实现要点

### 5.1 豆瓣热门懒加载实现
```javascript
// 分页加载逻辑
class DoubanLazyLoader {
    constructor() {
        this.pageSize = 20;
        this.currentPage = 0;
        this.loading = false;
        this.hasMore = true;
    }
    
    async loadMore() {
        if (this.loading || !this.hasMore) return;
        // 实现分页加载逻辑
    }
}
```

### 5.2 播放器自动控制
```javascript  
// 播放器智能控制
class SmartPlayerController {
    constructor() {
        this.autoJumpToPlayer = true;
        this.autoPauseOnLeave = true;
    }
    
    handleEpisodeSelect() {
        // 选集后自动跳转播放界面
    }
    
    handleHistoryPlay() {
        // 历史记录播放自动跳转
    }
    
    handlePageLeave() {
        // 离开页面自动暂停
    }
}
```

### 5.3 样式合并策略
- 将现有的多个CSS文件合并为单一文件
- 使用CSS变量定义主题色彩
- 采用BEM命名规范提高可维护性
- 优化CSS选择器性能

## 6. 部署兼容性保证

### 6.1 Vercel部署
- 保持现有的vercel.json配置
- 确保API代理功能正常
- 环境变量配置兼容

### 6.2 Cloudflare Pages部署  
- 保持Functions代理功能
- 静态资源CDN加速
- Edge计算优化

### 6.3 Docker部署
- 保持现有Dockerfile和docker-compose配置
- 容器内环境变量支持
- 端口映射和网络配置

## 7. 测试和验证计划

### 7.1 功能测试
- [ ] 搜索功能完整性测试
- [ ] 豆瓣热门懒加载测试
- [ ] 播放器自动控制测试
- [ ] 历史记录联动测试
- [ ] 设置功能完整性测试

### 7.2 兼容性测试
- [ ] 三种部署方式测试
- [ ] 多浏览器兼容性测试
- [ ] 移动端响应式测试
- [ ] 网络环境适配测试

### 7.3 性能测试
- [ ] 页面加载速度测试
- [ ] 懒加载性能测试
- [ ] 内存使用优化测试
- [ ] 网络请求优化测试

## 8. 交付物清单

### 8.1 代码文件
- [ ] 优化后的HTML主文件
- [ ] 合并后的CSS样式文件
- [ ] 增强的JavaScript功能模块
- [ ] 更新的配置文件

### 8.2 文档资料
- [ ] 更新的README.md
- [ ] 详细的功能使用说明
- [ ] 部署配置指南
- [ ] 更新日志

### 8.3 测试报告
- [ ] 功能测试报告
- [ ] 性能优化报告
- [ ] 兼容性测试报告

## 9. 项目亮点总结

1. **用户体验优化**：豆瓣热门懒加载，播放器智能控制
2. **代码质量提升**：样式系统统一，目录结构优化
3. **功能完整性**：保持原有功能基础上增强用户交互
4. **部署兼容性**：确保三种部署方式完全兼容
5. **界面美观性**：保持统一设计风格和色调
6. **性能优化**：分页加载，减少初始加载时间
7. **可维护性**：模块化设计，代码结构清晰

这个V2.1版本将在保持LibreTV原有优秀特性的基础上，显著提升用户体验和代码质量，是一次全面而有针对性的优化升级。
